
\documentclass[border=8pt, multi, tikz]{standalone}
\usepackage{import}
\subimport{../layers/}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d} %for including external image

\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:red,1;black,0.3}
\def\UnpoolColor{rgb:blue,2;green,1;black,0.3}
\def\FcColor{rgb:blue,5;red,2.5;white,5}
\def\FcReluColor{rgb:blue,5;red,5;white,4}
\def\SoftmaxColor{rgb:magenta,5;black,7}
\def\SumColor{rgb:green, 1}
\def\MultColor{rgb: magenta, 1}
\def\ConcColor{rgb:red, 5}

\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width=0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]

\node[canvas is zy plane at x=0] (temp) at (-3,0,0) {\includegraphics[width=8cm,height=8cm]{../examples/fcn8s/cats.jpg}};

\pic[shift={(0,0,0)}] at (0,0,0)
    {Box={
        name=conv_1,
        caption=1,
        xlabel={(64,)},
        zlabel=I,
        fill=\ConvColor,
        height=40,
        depth=40,
        width={2}
        }
    };

\pic[shift={(1,0,0)}] at (conv_1-east)
    {Box={
        name=conv_2,
        caption=2,
        xlabel={(64,)},
        zlabel=,
        fill=\ConvColor,
        height=20.0,
        depth=20.0,
        width={4.0}
        }
    };

\draw [connection]  (conv_1-east) -- node {\midarrow} (conv_2-west);

\pic[shift={(0,0,0)}] at (conv_2-east)
    {Box={
        name=conv_3,
        caption=3,
        xlabel={(32,)},
        zlabel=,
        fill=\ConvColor,
        height=20.0,
        depth=20.0,
        width={2.0}
        }
    };

\pic[shift={(0,0,0)}] at (conv_3-east)
    {Box={
        name=conv_4,
        caption=4,
        xlabel={(64,)},
        zlabel=I/2,
        fill=\ConvColor,
        height=20.0,
        depth=20.0,
        width={4.0}
        }
    };

    \draw[densely dashed]
    (conv_1-nearnortheast) coordinate(a) -- (conv_2-nearnorthwest)
    (conv_1-nearsoutheast) coordinate(b) -- (conv_2-nearsouthwest)
    (conv_1-farsoutheast) coordinate(c) -- (conv_2-farsouthwest)
    (conv_1-farnortheast) coordinate(d) -- (conv_2-farnorthwest)

    (a)--(b)--(c)--(d)
    ;

\pic[shift={(1,0,0)}] at (conv_4-east)
    {Ball={
        name=short_1,
        caption=,
        fill=\SumColor,
        opacity=0.4,
        radius=2.5,
        logo=$+$
        }
    };

\draw [connection]  (conv_4-east) -- node {\midarrow} (short_1-west);

\path (conv_2-southeast) -- (conv_2-northeast) coordinate[pos=1.25] (conv_2-top) ;
\path (conv_2-top |- short_1-north) coordinate (short_1-top)  ;

\draw [connection]  (conv_2-northeast)
-- node {\midline}(conv_2-northeast |- conv_2-top)
-- node {\midarrow}(conv_2-top -| short_1-north)
-- node {\midline}(short_1-north);

\pic[shift={(1,0,0)}] at (short_1-east)
    {Box={
        name=conv_5,
        caption=5,
        xlabel={(128,)},
        zlabel=,
        fill=\ConvColor,
        height=10.0,
        depth=10.0,
        width={4.0}
        }
    };

\draw [connection]  (short_1-east) -- node {\midarrow} (conv_5-west);

\pic[shift={(0,0,0)}] at (conv_5-east)
    {Box={
        name=conv_6,
        caption=6,
        xlabel={(64,)},
        zlabel=,
        fill=\ConvColor,
        height=10.0,
        depth=10.0,
        width={2.0}
        }
    };

\pic[shift={(0,0,0)}] at (conv_6-east)
    {Box={
        name=conv_7,
        caption=7,
        xlabel={(128,)},
        zlabel=I/4,
        fill=\ConvColor,
        height=10.0,
        depth=10.0,
        width={4.0}
        }
    };

    \draw[densely dashed]
    (conv_4-nearnortheast) coordinate(a) -- (conv_5-nearnorthwest)
    (conv_4-nearsoutheast) coordinate(b) -- (conv_5-nearsouthwest)
    (conv_4-farsoutheast) coordinate(c) -- (conv_5-farsouthwest)
    (conv_4-farnortheast) coordinate(d) -- (conv_5-farnorthwest)

    (a)--(b)--(c)--(d)
    ;

\pic[shift={(1,0,0)}] at (conv_7-east)
    {Ball={
        name=short_2,
        caption=,
        fill=\SumColor,
        opacity=0.4,
        radius=2.5,
        logo=$+$
        }
    };

\draw [connection]  (conv_7-east) -- node {\midarrow} (short_2-west);

\path (conv_5-southeast) -- (conv_5-northeast) coordinate[pos=1.25] (conv_5-top) ;
\path (conv_5-top |- short_2-north) coordinate (short_2-top)  ;

\draw [connection]  (conv_5-northeast)
-- node {\midline}(conv_5-northeast |- conv_5-top)
-- node {\midarrow}(conv_5-top -| short_2-north)
-- node {\midline}(short_2-north);

\node [shift={(0.35,0,0)}] at (short_2-east)(e1){\ldots};

\pic[shift={(0.5,0,0)}] at (e1.east)
{Ball={
		name=short_3,
		caption=,
		fill=\SumColor,
		opacity=0.4,
		radius=2.5,
		logo=$+$
	}
};



\end{tikzpicture}
\end{document}
